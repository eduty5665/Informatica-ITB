CREATE DATABASE FUNCIONARIOS
go

USE FUNCIONARIOS
GO

CREATE TABLE TB_FUNC(
	COD_FUNC INT IDENTITY(1,1) PRIMARY KEY, 
	NOME VARCHAR(80) NOT NULL,
	FILIAL VARCHAR(20) NOT NULL,
	COD_CARGO INT NOT NULL,
	COD_DEPTO INT NOT NULL,
	DATA_ADMISSAO DATETIME,
	SALARIO DECIMAL(10,2) NOT NULL,
	DEPENDENTES DECIMAL(10,2) NOT NULL,
	CPF CHAR(11) NOT NULL,
)
GO

CREATE TABLE TB_DEPTO(
	COD_DEPTO INT IDENTITY(10,10) PRIMARY KEY,
	NOME_DEPTO VARCHAR(20) NOT NULL,
	COD_FUNC INT NOT NULL,

	FOREIGN KEY (COD_FUNC) REFERENCES TB_FUNC (COD_FUNC),
)
GO

CREATE TABLE TB_CARGO(
	COD_CARGO INT IDENTITY(1,1) PRIMARY KEY, 
	NOME_CARGO VARCHAR(20) NOT NULL,
	COD_DEPTO INT NOT NULL,

	FOREIGN KEY (COD_DEPTO) REFERENCES TB_DEPTO (COD_DEPTO),
)
GO


INSERT INTO TB_DEPTO VALUES('Almoxarifado', 1) 
INSERT INTO TB_DEPTO VALUES('Manutenção', 2) 
INSERT INTO TB_DEPTO VALUES('RH', 3)
INSERT INTO TB_DEPTO VALUES('Suporte', 4)
INSERT INTO TB_DEPTO VALUES('Vendas', 5)
INSERT INTO TB_DEPTO VALUES('Marketing', 6)
INSERT INTO TB_DEPTO VALUES('Relacionamento', 7)


INSERT INTO TB_CARGO VALUES('Almoxarife', 10)


INSERT INTO TB_FUNC VALUES ('Sandro Luiz','São Paulo',1, 10, '12/05/1991', 6500, 1, '58789190017');
INSERT INTO TB_FUNC VALUES ('Gerson Sanches','Campinas',2, 20, '02/01/1995', 2335.90, 2, '43839805031');
INSERT INTO TB_FUNC VALUES ('Cristina Maia','Florianópolis',3, 40, '01/07/2000', 3300.70, 1, '53924945012');
INSERT INTO TB_FUNC VALUES ('Carla Fantim','São Paulo',4, 50, '12/05/1991', 6500, 1, '71688033017');
INSERT INTO TB_FUNC VALUES ('Débora Schwartz','Uberaba',4, 50, '12/05/1991', 6500, 1, '53962549404');
INSERT INTO TB_FUNC VALUES ('Sandra Rodrigues','Campinas',3, 40, '12/05/1991', 6500, 1, '52827468301');
INSERT INTO TB_FUNC VALUES ('Débora Spindola','Florianópolis',5, 60, '12/05/1991', 6500, 1, '22586634071');
INSERT INTO TB_FUNC VALUES ('Gerson Santana','Campinas',2, 20, '12/05/1991', 6500, 1, '01227891059');
INSERT INTO TB_FUNC VALUES ('Rodrigo Ruiz','São Paulo',5, 60, '12/05/1991', 6500, 1, '55206493082');
INSERT INTO TB_FUNC VALUES ('Julio Almeida','Florianópolis',1, 10, '12/05/1991', 6500, 1, '60666901082');
INSERT INTO TB_FUNC VALUES ('José Triburca','Campinas',4, 50, '12/05/1991', 6500, 1, '19855951093');
INSERT INTO TB_FUNC VALUES ('Pedro Santanella','São Paulo',3, 40, '12/05/1991', 6500, 1, '65685628072');
INSERT INTO TB_FUNC VALUES ('Rafaela Mendes','Uberaba',2, 30, '12/05/1991', 6500, 1, '16918757083');
INSERT INTO TB_FUNC VALUES ('Edineusa Martins','Campinas',4, 50, '12/05/1991', 6500, 1, '04323725043');
INSERT INTO TB_FUNC VALUES ('Saulo Ramos','São Paulo',2, 30, '12/05/1991', 6500, 1, '06607295045');
INSERT INTO TB_FUNC VALUES ('Edmundo Santos	','Uberaba',1, 10, '12/05/1991', 6500, 1, '96936192009');
INSERT INTO TB_FUNC VALUES ('Paulo Marcio','Florianópolis',2, 30, '12/05/1991', 6500, 1, '40704147033');
INSERT INTO TB_FUNC VALUES ('Arlete Mourão','São Paulo',5, 60, '12/05/1991', 6500, 1, '76830160049');
INSERT INTO TB_FUNC VALUES ('Rosália Souza','Sorocaba',6, 50, '12/05/1991', 6500, 1, '81198434015');
INSERT INTO TB_FUNC VALUES ('Samuel Rosa','Araraquara',6, 70, '12/05/1991', 6500, 1, '97869353060');
INSERT INTO TB_FUNC VALUES ('Samuel Rosa','Muzambinho',8, 50, '12/05/1991', 6500, 1, '65641635090');

SELECT * FROM TB_FUNC
SELECT * FROM TB_CARGO
SELECT * FROM TB_DEPTO

-------TAREFA 17

INSERT INTO TB_FUNC_BKP OUTPUT INSERTED.*
SELECT NOME, FILIAL , COD_DEPTO , COD_CARGO, DATA_ADMISSAO , SALARIO, DEPENDENTES, CPF FROM TB_FUNC;


DELETE FROM TB_FUNC_BKP OUTPUT DELETED.* WHERE FILIAL = 'Campinas';

SELECT @@TRANCOUNT; 
BEGIN TRANSACTION;  
SELECT @@TRANCOUNT;

 UPDATE TB_FUNC_BKP SET SALARIO *= 1.30
OUTPUT
INSERTED.NOME, INSERTED.FILIAL, INSERTED.COD_DEPTO, INSERTED.COD_CARGO,
INSERTED.DATA_ADMISSAO, INSERTED.SALARIO,
INSERTED.DEPENDENTES, INSERTED.CPF,
DELETED.SALARIO AS SALARIO_ANTIGO,
INSERTED.SALARIO AS SALARIO_NOVO
WHERE FILIAL = 'Uberaba';

COMMIT TRANSACTION;


UPDATE TB_FUNC_BKP SET SALARIO -= 800
OUTPUT
INSERTED.NOME, INSERTED.FILIAL, INSERTED.COD_DEPTO, INSERTED.COD_CARGO,
INSERTED.DATA_ADMISSAO, INSERTED.SALARIO,
INSERTED.DEPENDENTES, INSERTED.CPF,
DELETED.SALARIO AS SALARIO_ANTIGO,
INSERTED.SALARIO AS SALARIO_NOVO
WHERE FILIAL = 'Florianópolis';
